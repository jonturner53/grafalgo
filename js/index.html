<!doctype html5>
<html>
<head>
<style>
.headerFooter {
	position: absolute;
	background-color: navy;
	margin: 0px;
	font-family: "Verdana", sans-serif;
	color: cyan;
}

.stdButton {
	padding: 1px 5px 1px 5px;
	border: 1px solid black;
	background-color: beige;
	font-family: "Verdana", sans-serif;
	font-size: 100%;
	border-radius: 5px;
}

.fixedWidthButton {
	width: 80%;
	border: 1px solid black;
	margin: 1px 0px 1px 0px;
	padding: 1px 1px 1px 1px;
	background-color: beige;
	font-family: "Verdana", sans-serif;
	font-size: 100%;
	border-radius: 5px;
}

.smallButton {
	margin: 1px 1px 1px 1px;
	font-size: 5%
	border: 1px solid black;
	background-color: beige;
	border-radius: 2px;
}
</style>
</head>

<body>
<div style="position:absolute; width: 1000px; height: 800px;
			border-style: solid; border-width: 1px;">

	<div id="header" class="headerFooter"
		 style="margin:.2% .2% .2% .2%; height: 3.6%; width: 99.6%;
				font-size: 140%;
				text-align: center; padding: 4px 0 4px 0;"
	>Graph Algorithms and Data Structures</div>

	<textarea id="codeArea"
		style="position: absolute; top: 5%;
				margin:.2% .2% .2% .2%; width: 80%; height: 47%;
				color: black; font-family: courier; font-size: 100%;"
	></textarea>

	<textarea id="outputArea"
		style="position: absolute; bottom: .2%;
				margin:.2% .2% .2% .2%; width: 80%; height: 47%;
				color: black; font-family: courier; font-size: 100%;"
	></textarea>

	<div style="font-family: Verdana; font-size: 105%; position: absolute;
			   top:5%; left:81%; width:18%; height:48%;left-margin:.1%;">
		data structures<br>
		<div style="width:100%; height:7%; margin:.1% .1% .1% .1%;">
			<button id="dstructButton" class="smallButton;"
				style="margin:1% 0 0 0; font-size:5%; vertical-align: top;
					width:10%; height:70%;"></button>
			<select id="dstructMenu"
				style="font-size:100%; top-margin:.1%; height:90%; width:80%;
					vertical-align: top;">
			</select>
		</div>
		<div style="width:100%; height:7%; margin:.1% .1% .1% .1%;">
			<button id="testDstructButton" class="smallButton;"
				style="margin:1% 0 0 0; font-size:5%; vertical-align: top;
					width:10%; height:70%;"></button>
			<select id="testDstructMenu"
				style="font-size:100%; top-margin:.1%; height:90%; width:80%;
					vertical-align: top;">
			</select>
		</div>
		<div style="width:100%; height:3%;"> </div>
		algorithms<br>
		<div style="width:100%; height:7%; margin:.1% .1% .1% .1%;">
			<button id="algoButton" class="smallButton;"
				style="margin:1% 0 0 0; font-size:5%; vertical-align: top;
					width:10%; height:70%;"></button>
			<select id="algoMenu"
				style="font-size:100%; top-margin:.1%; height:90%; width:80%;
					vertical-align: top;">
			</select>
		</div>
		<div style="width:100%; height:7%; margin:.1% .1% .1% .1%;">
			<button id="testAlgoButton" class="smallButton;"
				style="margin:1% 0 0 0; font-size:5%; vertical-align: top;
					width:10%; height:70%;"></button>
			<select id="testAlgoMenu"
				style="font-size:100%; top-margin:.1%; height:90%; width:80%;
					vertical-align: top;">
			</select>
		</div>
		<div style="width:100%; height:3%;"> </div>
		approximations<br>
		<div style="width:100%; height:7%; margin:.1% .1% .1% .1%;">
			<button id="approxButton" class="smallButton;"
				style="margin:1% 0 0 0; font-size:5%; vertical-align: top;
					width:10%; height:70%;"></button>
			<select id="approxMenu"
				style="font-size:100%; top-margin:.1%; height:90%; width:80%;
					vertical-align: top;">
			</select>
		</div>
		<div style="width:100%; height:7%; margin:.1% .1% .1% .1%;">
			<button id="testApproxButton" class="smallButton;"
				style="margin:1% 0 0 0; font-size:5%; vertical-align: top;
					width:10%; height:70%;"></button>
			<select id="testApproxMenu"
				style="font-size:100%; top-margin:.1%; height:90%; width:80%;
					vertical-align: top;">
			</select>
		</div>
		<div style="width:100%; height:3%;"> </div>
		common<br>
		<div style="width:100%; height:7%; margin:.1% .1% .1% .1%">
			<button id="commonButton" class="smallButton;"
				style="margin:1% 0 0 0; font-size:5%; vertical-align: top;
					width:10%; height:70%;"></button>
			<select id="commonMenu"
				style="font-size:100%; top-margin:.1%; height:90%; width:80%;
					vertical-align: top;">
			</select>
		</div>
		<div style="width:100%; height:5%;"> </div>
		<button id="scratchButton" class="fixedWidthButton"
			style="width:80%">scratch pad</button>
	</div>

	<div style="font-family: Verdana; font-size: 100%; position: absolute;
			   bottom:.2%; right:.2%; width:19%; height:47%;">
		<input type="text" size="19" value="" id="argString"
               style="width:99%; left:.2%; font-size:100%">
		<div style="width:100%; height:1%;"> </div>
		<button id="runButton" class="fixedWidthButton">run</button><br>
		<button id="clearButton" class="fixedWidthButton">clear</button>
	</div>
</div>

<script type="module">
/** Send a get request and process reply.
 *  @param path is a relative path to the file to be retrieved.
 *  @return a promise; use the promises then() method to define
 *  the handler for the reply; use catch() method to handler errors
 */
function serverRequest(path, args=[]) {
	return new Promise(function(resolve, reject) {
		let request = new XMLHttpRequest();
		request.open("GET", path, true);
		request.onload = function() {
			if (this.responseText.startsWith("Error")) {
				console.log('serverRequest error:\n' +
						 '\trequest: ' + commandString + '\n' +
						 '\tresponse: ' + this.responseText + '\n');
				if (reject) reject();
			} else if (resolve) {
				if (args.length == 0) resolve(this.responseText);
				else resolve([this.responseText].concat(args));
			}
		}
		request.onerror = function() {
			if (reject) {
				reject(request.status, request.statusText);
			} else {
				console.log("serverRequest Error: " + request.statusText +
							" [" + request.status + "]");
			};
		}
		request.send();
	});
}

import { assert, AssertFail, EnableAssert as ea } from './common/Assert.mjs';
import { Tester, Mismatch, Proceed, matches } from './common/Testing.mjs';
import { range, shuffle, scramble, randomFraction, randomInteger, randomExp,
		 randomGeometric, randomTruncatedGeometric, randomPareto,
		 randomFill, randomPermutation, randomSample
	   } from './common/Random.mjs';

import ListSet from './dataStructures/basic/ListSet.mjs';
import ReverseLists from './dataStructures/basic/ReverseLists.mjs';
import MergeSets from './dataStructures/basic/MergeSets.mjs';
import List from './dataStructures/basic/List.mjs';
import ListPair from './dataStructures/basic/ListPair.mjs';
import Scanner from './dataStructures/basic/Scanner.mjs';

import Digraph from './dataStructures/graphs/Digraph.mjs';
import Flograph from './dataStructures/graphs/Flograph.mjs';
import Graph from './dataStructures/graphs/Graph.mjs';

import Forest from './dataStructures/trees/Forest.mjs';
import BinaryForest from './dataStructures/trees/BinaryForest.mjs';
import BalancedForest from './dataStructures/trees/BalancedForest.mjs';
import SplayForest from './dataStructures/trees/SplayForest.mjs';

import ArrayHeap from './dataStructures/heaps/ArrayHeap.mjs';
import FibHeaps from './dataStructures/heaps/FibHeaps.mjs';
import LeftistHeaps from './dataStructures/heaps/LeftistHeaps.mjs';
import LazyHeaps from './dataStructures/heaps/LazyHeaps.mjs';

import KeySets from './dataStructures/keysets/KeySets.mjs';
import DualKeySets from './dataStructures/keysets/DualKeySets.mjs';
import Map from './dataStructures/keysets/Map.mjs';

import OrderedHeaps from './dataStructures/specialty/OrderedHeaps.mjs';
import GroupHeap from './dataStructures/specialty/GroupHeap.mjs';
import PathSet from './dataStructures/specialty/PathSet.mjs';
import DynamicTrees from './dataStructures/specialty/DynamicTrees.mjs';

import bfs from './graphAlgorithms/misc/bfs.mjs';
import components from './graphAlgorithms/misc/components.mjs';
import dfs from './graphAlgorithms/misc/dfs.mjs';
import findSplit from './graphAlgorithms/misc/findSplit.mjs';
import nca from './graphAlgorithms/misc/nca.mjs';
import { randomGraph, randomDigraph, randomDag, randomBigraph, randomTree,
 		 randomConnectedGraph, randomRegularGraph, randomRegularBigraph,
		 randomFlograph
	   } from './graphAlgorithms/misc/RandomGraph.mjs';
import toposort from './graphAlgorithms/misc/toposort.mjs';

import mstK from './graphAlgorithms/mst/mstK.mjs';
import mstP from './graphAlgorithms/mst/mstP.mjs';
import mstPf from './graphAlgorithms/mst/mstPf.mjs';
import mstCT from './graphAlgorithms/mst/mstCT.mjs';
import hardcaseP from './graphAlgorithms/mst/hardcaseP.mjs';
import mstVerify from './graphAlgorithms/mst/mstVerify.mjs';

import sptDag from './graphAlgorithms/spath/sptDag.mjs';
import sptD from './graphAlgorithms/spath/sptD.mjs';
import sptDf from './graphAlgorithms/spath/sptDf.mjs';
import sptBM from './graphAlgorithms/spath/sptBM.mjs';
import sptVerify from './graphAlgorithms/spath/sptVerify.mjs';
import allpairsF from './graphAlgorithms/spath/allpairsF.mjs';
import allpairsEK from './graphAlgorithms/spath/allpairsEK.mjs';

import augment from './graphAlgorithms/maxflow/augment.mjs';
import maxflowD from './graphAlgorithms/maxflow/maxflowD.mjs';
import maxflowDST from './graphAlgorithms/maxflow/maxflowDST.mjs';
import maxflowFFsp from './graphAlgorithms/maxflow/maxflowFFsp.mjs';
import maxflowFFmc from './graphAlgorithms/maxflow/maxflowFFmc.mjs';
import maxflowFFcs from './graphAlgorithms/maxflow/maxflowFFcs.mjs';
import maxflowPPf from './graphAlgorithms/maxflow/maxflowPPf.mjs';
import maxflowPPhl from './graphAlgorithms/maxflow/maxflowPPhl.mjs';
import maxflowPP from './graphAlgorithms/maxflow/maxflowPP.mjs';
import flowfloor from './graphAlgorithms/maxflow/flowfloor.mjs';
import maxflowVerify from './graphAlgorithms/maxflow/maxflowVerify.mjs';
import maxflowHardcase from './graphAlgorithms/maxflow/maxflowHardcase.mjs';

import ncrK from './graphAlgorithms/mcflow/ncrK.mjs';
import ncrKGT from './graphAlgorithms/mcflow/ncrKGT.mjs';
import ncrJEK from './graphAlgorithms/mcflow/ncrJEK.mjs';
import mcflowJ from './graphAlgorithms/mcflow/mcflowJ.mjs';
import mcflowJEK from './graphAlgorithms/mcflow/mcflowJEK.mjs';
import mcflowO from './graphAlgorithms/mcflow/mcflowO.mjs';
import mcflowVerify from './graphAlgorithms/mcflow/mcflowVerify.mjs';

import Matching from './graphAlgorithms/match/Matching.mjs';
import Blossoms from './graphAlgorithms/match/Blossoms.mjs';
import bimatchF from './graphAlgorithms/match/bimatchF.mjs';
import bimatchHK from './graphAlgorithms/match/bimatchHK.mjs';
import wbimatchH from './graphAlgorithms/match/wbimatchH.mjs';
import matchEG from './graphAlgorithms/match/matchEG.mjs';
import wmatchE from './graphAlgorithms/match/wmatchE.mjs';
import wmatchGMG from './graphAlgorithms/match/wmatchGMG.mjs';
import matchVerify from './graphAlgorithms/match/matchVerify.mjs';
import wmatchVerify from './graphAlgorithms/match/wmatchVerify.mjs';

import mdmatchG from './graphAlgorithms/vmatch/mdmatchG.mjs';
import pbimatchHKT from './graphAlgorithms/vmatch/pbimatchHKT.mjs';
import pmatchEGT from './graphAlgorithms/vmatch/pmatchEGT.mjs';
import pmatchO from './graphAlgorithms/vmatch/pmatchO.mjs';
import pmatchVerify from './graphAlgorithms/vmatch/pmatchVerify.mjs';
import smatchGS from './graphAlgorithms/vmatch/smatchGS.mjs';
import wperfectE from './graphAlgorithms/vmatch/wperfectE.mjs';
import bidcsF from './graphAlgorithms/vmatch/bidcsF.mjs';
import dcsGT from './graphAlgorithms/vmatch/dcsGT.mjs';
import dcsVerify from './graphAlgorithms/vmatch/dcsVerify.mjs';

import ecolorG from './graphAlgorithms/ecolor/ecolorG.mjs';
import ecolorR from './graphAlgorithms/ecolor/ecolorR.mjs';
import ecolorVerify from './graphAlgorithms/ecolor/ecolorVerify.mjs';

import becSplit from './approxAlgorithms/vecolor/becSplit.mjs';
import becMdmatch from './approxAlgorithms/vecolor/becMdmatch.mjs';
import becPmatch from './approxAlgorithms/vecolor/becPmatch.mjs';
import becVerify from './approxAlgorithms/vecolor/becVerify.mjs';
import becDegreeBound from './approxAlgorithms/vecolor/becDegreeBound.mjs';
import becMatchBound from './approxAlgorithms/vecolor/becMatchBound.mjs';
import becFlowBound from './approxAlgorithms/vecolor/becFlowBound.mjs';
import becHardCase from './approxAlgorithms/vecolor/becHardCase.mjs';
import becRandomCase from './approxAlgorithms/vecolor/becRandomCase.mjs';

import EdgeGroups from './approxAlgorithms/vecolor/EdgeGroups.mjs';
import EdgeGroupColors from './approxAlgorithms/vecolor/EdgeGroupColors.mjs';
import EdgeGroupLayers from './approxAlgorithms/vecolor/EdgeGroupLayers.mjs';
import {maxGroupCount, maxOutDegree, lowerBound, wcUbound, randUbound}
			from './approxAlgorithms/vecolor/egcCommon.mjs'; 
import egcRandomCase from './approxAlgorithms/vecolor/egcRandomCase.mjs';
import egcVerify from './approxAlgorithms/vecolor/egcVerify.mjs';
import egcT1 from './approxAlgorithms/vecolor/egcT1.mjs';
import egcT2 from './approxAlgorithms/vecolor/egcT2.mjs';
import egcKKP1 from './approxAlgorithms/vecolor/egcKKP1.mjs';
import egcKKP2 from './approxAlgorithms/vecolor/egcKKP2.mjs';
import egcYM from './approxAlgorithms/vecolor/egcYM.mjs';

import hpcRandom from './approxAlgorithms/hpc/hpcRandom.mjs';
import hpcVerify from './approxAlgorithms/hpc/hpcVerify.mjs';
import hpcPAV from './approxAlgorithms/hpc/hpcPAV.mjs';
import hpcKT from './approxAlgorithms/hpc/hpcKT.mjs';

let codeArea = document.getElementById("codeArea");
let outputArea = document.getElementById("outputArea");

/** Substitute for console.log. */
function log() {
	let s = '';
	for (let i = 0; i < arguments.length; i++) 
		s += arguments[i] + ' ';
	outputArea.value += s + '\n';
}

let currentMenu = null;		// when null, scratch pad is selected
function updateCurrentMenu(menu) {
	if (currentMenu == null) {
		scratchPad = codeArea.value;
		scratchButton.style.backgroundColor = 'beige';
	} else {
		currentMenu.deactivate();
	}
	currentMenu = menu; currentMenu.activate();
}

let scratchPad = '// scratch pad\n';
codeArea.value = scratchPad;
let scratchButton = document.getElementById("scratchButton");
scratchButton.style.backgroundColor = 'lightGreen';
scratchButton.addEventListener("click", () => {
	if (currentMenu == null) return;
	currentMenu.deactivate();
	codeArea.value = scratchPad;
	scratchButton.style.backgroundColor = 'lightGreen';
	currentMenu = null;
});

/** Menu class implements selector/button combo */
class Menu {
	constructor(selector, button, path, unit) {
		this.fileContents = '';
		this.selector = selector;
		this.button = button;
		this.selector.addEventListener("change", () => this.select());
		this.button.addEventListener("click", () => this.click());
		this.setup(path, unit);
	}

	/* Initialize selector.innerHTML.
	 * @param dir specifies the (root) directory in which to look for mjs files
	 * @param unit is a flag which specifies that only unit test files
	 * should be included
	 */
	setup(path, unit) {
		this.getFileInfo(path, (reply) => {
			// reply is now a vector of the form
			// [[dir-path file1 file2 ...] [ ditto ] ... ]
			// where dir-path is a directory path and the listed files
			// appear in that directory (some may be sub-directories)
			reply.sort((a,b) => (a[0]<b[0] ? -1 : (a[0]>b[0] ? 1 : 0)));
			let s = ''
			for (let vec of reply) {
				let dir = vec[0].match(/[^\/]+\//g);
				if (dir == null) continue;
				let last = dir.length-1;
				let isunit = (dir[last] == 'unit/');
				if (unit != isunit) continue;
				let label = (isunit ? dir[last-1] : '') + dir[last];
				let files = '';
				for (let i = 1; i < vec.length; i++) {
					let f = vec[i];
					if (f.endsWith('.mjs'))
						files += `<option value="${vec[0]+f}">${f.slice(0,-4)}</option>`;
				}
				if (files.length > 0)
					s += `<optgroup label="${label}"></optgroup>${files}`
			}
			this.selector.innerHTML = s;
		});
	}

	getFileInfo(path, returnValue) {
		if (!path.endsWith('/')) path += '/';
		serverRequest(path)
			.then(function(reply) {
				//extract lists of directories and files from reply
				let vec = [ path ];
				let dirs = []; let files = [];
				let rx = /<a href="([^"]+)"/gm;
				let f = rx.exec(reply);
				while (f != null) {
					if (!f[1].startsWith('/') && f[1].endsWith('/')) {
						dirs.push(f[1]); vec.push(f[1]);
					} else if (f[1].endsWith('.mjs')) {
						vec.push(f[1]);
					}
					f = rx.exec(reply);
				}
				let tvec = [ vec ];
				if (dirs.length == 0) {
					returnValue(tvec); return;
				}
				// for each directory make recursive call
				let count = 0;
				dirs.forEach(function(d) {
					this.getFileInfo(path + d, function(reply) {
							tvec = tvec.concat(reply)
							if (++count == dirs.length)
                            	returnValue(tvec);
                        });
					}.bind(this));
			}.bind(this));
	}

	select() {
		updateCurrentMenu(this);
		let file = this.selector.value;
		serverRequest(file)
			.then(function(reply) {
				this.fileContents = reply.replace(/[\t]/gm, '    ');
				codeArea.value = this.fileContents;
			}.bind(this));
	}

	click() {
		if (this.fileContents == '') {
			this.select();
		} else {
			updateCurrentMenu(this);
			codeArea.value = this.fileContents;
		}
	}

	activate() {
		this.button.style.backgroundColor = 'lightGreen';
		codeArea.value = this.fileContents;
	}

	deactivate() {
		this.button.style.backgroundColor = 'beige';
		this.fileContents = codeArea.value;
	}

}

let dstruct = new Menu(
		document.getElementById("dstructMenu"),
		document.getElementById("dstructButton"),
		'dataStructures/', false
);

let testDstruct = new Menu(
		document.getElementById("testDstructMenu"),
		document.getElementById("testDstructButton"),
		'dataStructures/', true
);

let algo = new Menu(
		document.getElementById("algoMenu"),
		document.getElementById("algoButton"),
		'graphAlgorithms/', false
);

let testAlgo = new Menu(
		document.getElementById("testAlgoMenu"),
		document.getElementById("testAlgoButton"),
		'graphAlgorithms/', true
);

let approx = new Menu(
		document.getElementById("approxMenu"),
		document.getElementById("approxButton"),
		'approxAlgorithms/', false
);

let testApprox = new Menu(
		document.getElementById("testApproxMenu"),
		document.getElementById("testApproxButton"),
		'approxAlgorithms/', true
);

let common = new Menu(
		document.getElementById("commonMenu"),
		document.getElementById("commonButton"),
		'common/', false
);

let clearButton = document.getElementById("clearButton");
clearButton.addEventListener("click", () => { outputArea.value = ''; } );

let runButton = document.getElementById("runButton");
runButton.addEventListener("click", () => {
	eval(codeArea.value.replace(/^[ \t]*import/gm, '// import')
		  				.replace(/console.log/gm, 'log'));
});

let argv = [];
let argString = document.getElementById("argString");
argString.addEventListener('change', () => {
	let s = document.getElementById("argString").value;
	argv = argString.value.trim().split(/ +/);
});

</script>
</body>
</html>
